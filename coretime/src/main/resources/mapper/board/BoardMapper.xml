<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.flow.coretime.board.mapper.BoardMapper">

	<insert id="save" parameterType="com.flow.coretime.board.dto.Board">
		INSERT INTO BOARD(
			AUTHOR, EMAIL, DEPARTMENT_NAME, TITLE, CONTENT, BOARD_TYPE, ROLE
		) VALUES (
			#{author}, #{email}, #{departmentName}, #{title}, #{content}, #{boardType},
			#{role}
		)
	</insert>
	
	<select id="findById" parameterType="long"
	resultType="com.flow.coretime.board.dto.Board">
	
		SELECT
			ID, AUTHOR, EMAIL,DEPARTMENT_NAME, TITLE, CONTENT, CREATED_AT, UPDATED_AT, BOARD_TYPE, ROLE		
		FROM
			BOARD
		WHERE
			ID = #{id}
	</select>
	
	<select id="findAll" resultType="com.flow.coretime.board.dto.Board">
	
		SELECT
			ID, AUTHOR, EMAIL, DEPARTMENT_NAME, TITLE, CONTENT, VIEW_COUNT, CREATED_AT, UPDATED_AT, BOARD_TYPE, ROLE
		FROM
			BOARD
		ORDER BY
			ID DESC
	
	</select>
	
	<update id="update" parameterType="com.flow.coretime.board.dto.Board">
	
		UPDATE
			BOARD
		SET
			TITLE = #{title},
			CONTENT = #{content},
			UPDATED_AT = SYSDATE
		WHERE
			ID = #{id}
	
	</update>
	
	<delete id="deleteById" parameterType="long">
	
		DELETE FROM
			BOARD
		WHERE
			ID = #{id}
	
	</delete>
	
	<update id="updateViewCount" parameterType="long">
	
		UPDATE
			BOARD
		SET
			VIEW_COUNT = VIEW_COUNT + 1
		WHERE
			ID = #{id}
	
	</update>
	
	<sql id="searchCondition">
	
		<where>
		
		<if test="boardType ! = null and boardType ! = ''">
		
			And Board_TYPE = #{boardType}
		
		</if>
		
		<if test="searchType ! = null and keyword ! = null and keyword ! = ''">
		
			<choose>
			
			<when test="searchType == 'title'">
			
				AND TITLE LIKE '%' || #{keyword} || '%'
			
			</when>
			
			<when test="searchType == 'content'">
			
				AND CONTENT LIKE '%' || #{keyword} || '%'
			
			</when>
			
			<when test="searchType == 'author'">
			
				AND AUTHOR LIKE '%' || #{keyword} || '%'
			
			</when>
			
			</choose>
		
		</if>
		
		</where>
	
	</sql>
	
	<select id="findWithPaging" parameterType="map"
	resultType="com.flow.coretime.board.dto.Board">
	
		SELECT
			ID,
			AUTHOR,
			EMAIL,
			DEPARTMENT_NAME,
			TITLE,
			CONTENT,
			VIEW_COUNT,
			CREATED_AT,
			UPDATED_AT,
			BOARD_TYPE,
			ROLE
		FROM
			BOARD
			
		<include refid="searchCondition"/>
		
		ORDER BY
			ID DESC
		OFFSET #{offset} ROWS
		FETCH NEXT #{pageSize} ROWS ONLY>
	</select>
	
	<select id="count" parameterType="map" resultType="int">
	
		SELECT
			COUNT(*)
		FROM
			BOARD
		<include refid="searchCondition"/>
	
	</select>
	
</mapper>
