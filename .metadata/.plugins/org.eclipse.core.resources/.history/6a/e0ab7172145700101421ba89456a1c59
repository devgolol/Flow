<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<style>
table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

th, td {
	border: 1px solid #ddd;
	padding: 8px;
	text-align: left;
}

th {
	background-color: #f2f2f2;
}

.container {
	display: flex;
	background-color: "white";
}

#nav {
	width: 200px; /* 내비게이션 너비 설정 (원하는 대로 조절) */
	/* background-color: #f0f0f0; /* 내비게이션 구분용 배경색 (선택 사항) */
	padding: 10px;
	box-sizing: border-box; /* 패딩이 너비에 포함되도록 */
}

.main-content { /* 메인 콘텐츠 div의 클래스 */
	flex-grow: 1; /* 남은 공간을 모두 차지하도록 확장 */
	padding: 20px; /* 메인 콘텐츠 여백 추가 */
	box-sizing: border-box;
}
</style>

</head>
<body>
	<div class="container">
		<div id="nav">
			<%@ include file="leftNav.jsp"%>
		</div>
		
		<div class="main-content">
			<h1>등록된 사용자 목록</h1>
			<h2>사용자 목록 (${pageInfo.total}명)</h2>

			
			<c:if test="${empty userList}">
				<p>등록된 사용자가 없습니다.</p>
			</c:if>

			<c:if test="${not empty userList}">
			<div>
			<button onclick="location.href='/users/new'">신규 유저 생성</button>
			<button id= "deleteSelectedUsersBtn">유저 삭제</button>
			</div>
				<table>
					<thead>
						<tr>
							<th><input type="checkbox" id="selectAllUsers"></th>
							<th>이름</th>
							<th>아이디</th>
							<th>이메일</th>
							<th>전화번호</th>
							<th>직위</th>
							<th>부서</th>
							<th>생년월일</th>
							<th>생성일</th>
							<th>수정일</th>
							<th>역할</th>
						</tr>
					</thead>
					<tbody>
						<c:forEach var="user" items="${userList}">
							<tr>
								<td><input type="checkbox" name="selectedUsers" value="${user.id}"></td>
								<td>${user.name}</td>
								<td>${user.id}</td>
								<td>${user.email}</td>
								<td>${user.tel}</td>
								<td>${user.rank}</td>
								<td>${user.department}</td>
								<td>${user.birth}</td>
								<td>${user.createdAt}</td>
								<td>${user.updatedAt}</td>
								<td>${user.role}</td>
							</tr>
						</c:forEach>
					</tbody>
				</table>
				<div class="pagination">
                <c:if test="${pageInfo.hasPreviousPage}"> <%-- PageInfo의 hasPreviousPage 사용 --%>
                    <a href="/users?page=${pageInfo.prePage}&size=${pageInfo.pageSize}">이전</a>
                </c:if>
                <c:if test="${!pageInfo.hasPreviousPage}">
                    <span class="disabled">이전</span>
                </c:if>

                <c:forEach var="pageNum" items="${pageInfo.navigatepageNums}"> <%-- PageInfo의 navigatepageNums 사용 --%>
                    <c:choose>
                        <c:when test="${pageNum eq pageInfo.pageNum}"> <%-- 현재 페이지 번호는 pageInfo.pageNum --%>
                            <a href="/users?page=${pageNum}&size=${pageInfo.pageSize}" class="active">${pageNum}</a>
                        </c:when>
                        <c:otherwise>
                            <a href="/users?page=${pageNum}&size=${pageInfo.pageSize}">${pageNum}</a>
                        </c:otherwise>
                    </c:choose>
                </c:forEach>

                <c:if test="${pageInfo.hasNextPage}"> <%-- PageInfo의 hasNextPage 사용 --%>
                    <a href="/users?page=${pageInfo.nextPage}&size=${pageInfo.pageSize}">다음</a>
                </c:if>
                <c:if test="${!pageInfo.hasNextPage}">
                    <span class="disabled">다음</span>
                </c:if>
            </div>
			</c:if>
		</div>
	</div>
	<script>
        document.getElementById('selectAllUsers').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('input[name="selectedUsers"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
        
        document.getElementById('deleteSelectedUsersBtn').addEventListener('click', function(){
			const selectedIds= [];
			const checkboxes= document.querySelectorAll('input[name="selectedUsers"]');
			checkboxes.forEach(checkbox=>{
				selectedIds.push(checkbox.value);
			})
			//console.log(selectedIds);
			fetch('/users/delete')
		});
    </script>
</body>
</html>