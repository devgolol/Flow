<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<style>
table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

th, td {
	border: 1px solid #ddd;
	padding: 8px;
	text-align: left;
}

th {
	background-color: #f2f2f2;
}

.container {
	display: flex;
	background-color: "white";
}

#nav {
	width: 200px; /* 내비게이션 너비 설정 (원하는 대로 조절) */
	/* background-color: #f0f0f0; /* 내비게이션 구분용 배경색 (선택 사항) */
	padding: 10px;
	box-sizing: border-box; /* 패딩이 너비에 포함되도록 */
}

.main-content { /* 메인 콘텐츠 div의 클래스 */
	flex-grow: 1; /* 남은 공간을 모두 차지하도록 확장 */
	padding: 20px; /* 메인 콘텐츠 여백 추가 */
	box-sizing: border-box;
}
</style>

</head>
<body>
	<div class="container">
		<div id="nav">
			<%@ include file="leftNav.jsp"%>
		</div>
		
		<div class="main-content">
			<h1>등록된 사용자 목록</h1>
			<h2>사용자 목록 (${pageInfo.total}명)</h2>

			
			<c:if test="${empty userList}">
				<p>등록된 사용자가 없습니다.</p>
			</c:if>

			<c:if test="${not empty userList}">
			<div>
			<button onclick="location.href='/users/new'">신규 유저 생성</button>
			<button onclick="location.href='/users/delete'">유저 삭제</button>
			</div>
				<table>
					<thead>
						<tr>
							<th><input type="checkbox" id="selectAllUsers"></th>
							<th>이름</th>
							<th>아이디</th>
							<th>이메일</th>
							<th>전화번호</th>
							<th>직위</th>
							<th>부서</th>
							<th>생년월일</th>
							<th>생성일</th>
							<th>수정일</th>
							<th>역할</th>
						</tr>
					</thead>
					<tbody>
						<c:forEach var="user" items="${userList}">
							<tr>
								<td><input type="checkbox" name="selectedUsers" value="${user.id}"></td>
								<td>${user.name}</td>
								<td>${user.id}</td>
								<td>${user.email}</td>
								<td>${user.tel}</td>
								<td>${user.rank}</td>
								<td>${user.department}</td>
								<td>${user.birth}</td>
								<td>${user.createdAt}</td>
								<td>${user.updatedAt}</td>
								<td>${user.role}</td>
							</tr>
						</c:forEach>
					</tbody>
				</table>
				<div class="pagination">
                <c:if test="${pageInfo.hasPreviousPage}"> <%-- PageInfo의 hasPreviousPage 사용 --%>
                    <a href="/users?page=${pageInfo.prePage}&size=${pageInfo.pageSize}">이전</a>
                </c:if>
                <c:if test="${!pageInfo.hasPreviousPage}">
                    <span class="disabled">이전</span>
                </c:if>

                <c:forEach var="pageNum" items="${pageInfo.navigatepageNums}"> <%-- PageInfo의 navigatepageNums 사용 --%>
                    <c:choose>
                        <c:when test="${pageNum eq pageInfo.pageNum}"> <%-- 현재 페이지 번호는 pageInfo.pageNum --%>
                            <a href="/users?page=${pageNum}&size=${pageInfo.pageSize}" class="active">${pageNum}</a>
                        </c:when>
                        <c:otherwise>
                            <a href="/users?page=${pageNum}&size=${pageInfo.pageSize}">${pageNum}</a>
                        </c:otherwise>
                    </c:choose>
                </c:forEach>

                <c:if test="${pageInfo.hasNextPage}"> <%-- PageInfo의 hasNextPage 사용 --%>
                    <a href="/users?page=${pageInfo.nextPage}&size=${pageInfo.pageSize}">다음</a>
                </c:if>
                <c:if test="${!pageInfo.hasNextPage}">
                    <span class="disabled">다음</span>
                </c:if>
            </div>
			</c:if>
		</div>
	</div>
	<script>
        // "전체 선택" 체크박스 기능
        document.getElementById('selectAllUsers').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('input[name="selectedUsers"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        // "선택 유저 삭제" 버튼 기능 (JavaScript로 POST 요청 전송 예시)
        document.getElementById('deleteUsersBtn').addEventListener('click', function() {
            const selectedIds = [];
            document.querySelectorAll('input[name="selectedUsers"]:checked').forEach(checkbox => {
                selectedIds.push(checkbox.value);
            });

            if (selectedIds.length === 0) {
                alert('삭제할 유저를 선택해주세요.');
                return;
            }

            if (confirm(selectedIds.length + ' 명의 유저를 정말로 삭제하시겠습니까?')) {
                // 실제 삭제 요청을 POST 또는 DELETE 메소드로 서버에 전송하는 코드
                // 여기서는 예시로 fetch API를 사용합니다.
                fetch('/users/delete', { // 삭제를 처리할 서버의 엔드포인트
                    method: 'POST', // 또는 'DELETE'
                    headers: {
                        'Content-Type': 'application/json',
                        // 필요하다면 CSRF 토큰 등을 여기에 추가
                    },
                    body: JSON.stringify({ ids: selectedIds }) // 선택된 ID들을 JSON 형태로 전송
                })
                .then(response => {
                    if (response.ok) {
                        alert('선택된 유저가 성공적으로 삭제되었습니다.');
                        location.reload(); // 페이지 새로고침하여 목록 업데이트
                    } else {
                        alert('유저 삭제 중 오류가 발생했습니다.');
                    }
                })
                .catch(error => {
                    console.error('삭제 요청 중 오류:', error);
                    alert('서버와 통신 중 오류가 발생했습니다.');
                });
            }
        });
    </script>
</body>
</html>