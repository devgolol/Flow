<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	/* 에러 메시지 스타일 */
	.error-message {
	    color: red;
	    font-size: 0.9em;
	    margin-left: 5px;
	    display: none; /* 기본적으로 숨김 */
	}
</style>
<script>
	function validateForm(event) {
	    let isValid = true; // 폼 전체의 유효성 상태

	    // 모든 에러 메시지 초기화 (새로운 제출 시 이전 에러 숨기기)
	    document.querySelectorAll('.error-message').forEach(span => {
	        span.style.display = 'none';
	        span.textContent = ''; // 텍스트도 비워줍니다.
	    });

	    // --- 개별 필드 유효성 검사 ---

	    // 이름 (한글)
	    const nameInput = document.getElementById("name");
	    const nameError = document.getElementById("nameError");
	    if (nameInput.value.trim() === "") {
	        nameError.style.display = "inline";
	        nameError.textContent = "이름을 입력해주세요.";
	        nameInput.focus();
	        event.preventDefault();
	    }

	    // 아이디
	    const idInput = document.getElementById("id");
	    const idError = document.getElementById("idError"); // 기존 idErrorSpan 대신 명확한 변수명
	    if (idInput.value.trim() === "") {
	        idError.style.display = "inline";
	        idError.textContent = "아이디를 입력해주세요.";
	        idInput.focus();
	        event.preventDefault();
	    }
	    // 백엔드에서 온 중복 ID 메시지는 window.onload에서 처리되므로 여기선 초기화만 합니다.

	    // 비밀번호
	    const passwordInput = document.getElementById("password");
	    const passwordError = document.getElementById("passwordError");
	    if (passwordInput.value.trim() === "") {
	        passwordError.style.display = "inline";
	        passwordError.textContent = "비밀번호를 입력해주세요.";
	        passwordInput.focus();
	        event.preventDefault();
	    }

	    // 비밀번호 확인
	    const confirmPasswordInput = document.getElementById("confirmPassword");
	    const confirmPasswordError = document.getElementById("confirmPasswordError");
	    if (confirmPasswordInput.value.trim() === "") {
	        confirmPasswordError.style.display = "inline";
	        confirmPasswordError.textContent = "비밀번호 확인을 입력해주세요.";
	        confirmPasswordInput.focus();
	        event.preventDefault();
	    } else if (passwordInput.value !== confirmPasswordInput.value) {
	        confirmPasswordError.style.display = "inline";
	        confirmPasswordError.textContent = "비밀번호가 일치하지 않습니다.";
	        confirmPasswordInput.focus();
	        event.preventDefault();
	    }

	    // 이메일
	    const emailInput = document.getElementById("email");
	    const emailError = document.getElementById("emailError");
	    if (emailInput.value.trim() === "") {
	        emailError.style.display = "inline";
	        emailError.textContent = "이메일을 입력해주세요.";
	        emailInput.focus();
	        event.preventDefault();
	    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) { // 간단한 이메일 형식 검사
	        emailError.style.display = "inline";
	        emailError.textContent = "유효한 이메일 형식을 입력해주세요.";
	        emailInput.focus();
	        event.preventDefault();
	    }

	    // 전화번호
	    const telInput = document.getElementById("tel");
	    const telError = document.getElementById("telError");
	    if (telInput.value.trim() === "") {
	        telError.style.display = "inline";
	        telError.textContent = "전화번호를 입력해주세요.";
	        telInput.focus();
	        event.preventDefault();
	    } else if (!/^(01[016789])-([0-9]{3,4})-([0-9]{4})$/.test(telInput.value)) { // 전화번호 형식 검사
	        telError.style.display = "inline";
	        telError.textContent = "유효한 전화번호 형식을 입력해주세요 (예: 010-1234-5678).";
	        telInput.focus();
	        event.preventDefault();
	    }

	    // 직위
	    const rankSelect = document.getElementById("rankSelect");
	    const rankError = document.getElementById("rankError");
	    if (rankSelect.value === "") {
	        rankError.style.display = "inline";
	        rankError.textContent = "직위를 선택해주세요.";
	        rankSelect.focus();
	        event.preventDefault();
	    } else {
	        rankError.style.display = "none";
	    }

	    // 부서
	    const departmentSelect = document.getElementById("departmentSelect");
	    const departmentError = document.getElementById("departmentError");
	    if (departmentSelect.value === "") {
	        departmentError.style.display = "inline";
	        departmentError.textContent = "부서를 선택해주세요.";
	        departmentSelect.focus();
	        event.preventDefault();
	    } else {
	        departmentError.style.display = "none";
	    }

	    // 생년월일 (간단한 필수 여부만)
	    const birthInput = document.getElementById("birth");
	    const birthError = document.getElementById("birthError");
	    if (birthInput.value.trim() === "") {
	        birthError.style.display = "inline";
	        birthError.textContent = "생년월일을 입력해주세요.";
	        birthInput.focus();
	        event.preventDefault();
	    }
	}

	// 직위 에러 메시지 숨김
	function clearRankError() {
	    var rankSelect = document.getElementById("rankSelect");
	    var rankError = document.getElementById("rankError");
	    if (rankSelect.value !== "") {
	        rankError.style.display = "none";
	        rankError.textContent = '';
	    }
	}

	// 부서 에러 메시지 숨김
	function clearDepartmentError() {
	    var departmentSelect = document.getElementById("departmentSelect");
	    var departmentError = document.getElementById("departmentError");
	    if (departmentSelect.value !== "") {
	        departmentError.style.display = "none";
	        departmentError.textContent = '';
	    }
	}

	// 페이지 로드 시 백엔드에서 전달된 ID 오류 메시지 표시 (기존 유지)
	window.onload = function() {
	    var idErrorSpan = document.getElementById("idError");
	    if (idErrorSpan && "${idErrorMessage}" && "${idErrorMessage}" !== "") {
	        idErrorSpan.style.display = "inline";
	        idErrorSpan.textContent = "${idErrorMessage}";
	    } else if (idErrorSpan) {
	        idErrorSpan.style.display = "none";
	    }
	};
</script>
</head>
<body>
<body>
<h2>신규 유저 생성</h2>
<%-- <form:form modelAttribute="user" method="post" action="/users/insert" onsubmit="return validateForm()">
	<p>이름 (한글): <form:input path="name" id="name" value= "박지훈"/></p>
    <p>아이디: <form:input path="id" id="id" value= "flow1"/>
        <span id="idError" style="color: red;">
            ${idErrorMessage}
        </span>
        <form:errors path="id" cssStyle="color: red;"/>
    </p>
    <p>비밀번호: <form:password path="password" value= "1234"/></p>
    <p>비밀번호 확인: <form:password path="confirmPassword" value= "1234"/></p>
    <p>이메일: <form:input path="email" value= "jack981109@naver.com"/></p>
    <p>전화번호: <form:input path="tel" value= "010-6230-1825"/></p>
    <p>직위: 
        <form:select path="rank" id="rankSelect" onchange="clearRankError()">
            <form:option value="">선택</form:option>
            <form:option value="사원">사원</form:option>
            <form:option value="대리">대리</form:option>
            <form:option value="과장">과장</form:option>
            <form:option value="차장">차장</form:option>
            <form:option value="부장">부장</form:option>
        </form:select>
        <span id="rankError" style="color: red; display: none;">직위를 선택해주세요.</span>
        <form:errors path="rank" cssStyle="color: red;"/>
    </p>
    <p>부서: <form:input path="department" value= "개발"/></p>
    <p>생년월일: <form:input path="birth" value= "2025-06-30"/></p>

    <p>
        <button type="submit">저장</button>
        <button type="submit" formaction="/users/saveAndContinue">저장 후 계속 생성</button>
    </p>
</form:form> --%>
<form:form modelAttribute="user" method="post" action="/users/insert" onsubmit="return validateForm(event)">
	<p>이름 (한글): <form:input path="name" id="name"/>
        <span id="nameError" class="error-message"></span></p>
	
    <p>아이디: <form:input path="id" id="id"/>
        <span id="idError" class="error-message"></span>
        <form:errors path="id" cssStyle="color: red;"/> <%-- 서버 측 ID 유효성 에러 (예: @NotBlank) --%>
    </p>
    <p>비밀번호: <form:password path="password" id="password"/>
        <span id="passwordError" class="error-message"></span></p>
    <p>비밀번호 확인: <form:password path="confirmPassword" id="confirmPassword"/>
        <span id="confirmPasswordError" class="error-message"></span></p>
    <p>이메일: <form:input path="email" id="email"/>
        <span id="emailError" class="error-message"></span></p>
    <p>전화번호: <form:input path="tel" />
        <form:errors path="tel" cssClass="error-message" id="tel"/></p>
    <p>직위: 
        <form:select path="rank" id="rankSelect" onchange="clearRankError()">
            <form:option value="">선택</form:option>
            <form:option value="사원">사원</form:option>
            <form:option value="대리">대리</form:option>
            <form:option value="과장">과장</form:option>
            <form:option value="차장">차장</form:option>
            <form:option value="부장">부장</form:option>
        </form:select>
        <span id="rankError" class="error-message"></span>
        <form:errors path="rank" cssStyle="color: red;"/>
    </p>
    <p>부서: 
        <form:select path="department" id="departmentSelect" onchange="clearDepartmentError()"> <%-- 부서 select 추가 --%>
            <form:option value="">선택</form:option>
            <form:option value="개발팀">개발팀</form:option>
            <form:option value="영업팀">영업팀</form:option>
            <form:option value="마케팅팀">마케팅팀</form:option>
            <form:option value="인사팀">인사팀</form:option>
            <form:option value="회계팀">회계팀</form:option>
        </form:select>
        <span id="departmentError" class="error-message"></span> <%-- 부서 에러 메시지 스팬 --%>
        <form:errors path="department" cssStyle="color: red;"/>
    </p>
    <p>생년월일: <form:input path="birth" id="birth" type="date"/> <%-- type="date" 추가 --%>
        <span id="birthError" class="error-message"></span></p>

    <p>
        <button type="submit">저장</button>
    </p>
</form:form>
</body>
</html>